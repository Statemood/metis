#! /bin/bash

# ------------------------------------------
#
# Created by Statemood, 2014.01.14 17:30
# Updated by Statemood, 2014.01.18 15:30
#            Statemood@gmail.com
#
# Project metis:
#   http://github.com/Statemood/metis-2.1
# ------------------------------------------

# metis send 	cmd 	"ls" to server ipaddress
# 							 	group  groupname
#			 	file "file" ^^^^^^^^^^^^^^^^^^^
#
#		get  	file "file" from server ipaddress
#
#		info 	ipaddress
#
#		list 	keyword(default display all)
#			 	group	groupname, group by xxx
#			 	server ip,hostname,description,
#
#		login	server-keyword: ip,hostname,alias
#
. $(dirname $(dirname $0))/fun/load || exit 1

load metis:cfg:settings
load metis:fun:default
load metis:fun:check
load metis:fun:db

#check range time work
#check login

for args in "$@"
do
    case $args in
        but)
            # test
            ;;
        cmd)
            Commands="$2"
            check input   "$Commans"
            #check syntax  "$command"
            #check command "$command"
            shift 1
            ;;
        except)
            # test
            ;;
        file)
            filename="$2"
            check input   "$filename"
            check file    "$filename"
            shift 2
            ;;
        get)
	        # get remote-file from server 10.1 save to local-path
            
            check input  "$2"
            server=`echo "$2" | awk -F ':' '{print $1}'`
            source=`echo "$2" | awk -F ':' '{print $2}'`
            saveto="$3"
            check exist  $saveto
            shift 
            ;;
        send)
	        # send file local-file to server 10.1
			#					   to group  dbs
	        # send cmd  "ls" 	   to server 10.1
	        #					   to group  dbs
            Sendaction="$2"
	        check input  "$2"
	        check accept "$2" "file|cmd"
            shift 1
	        ;;
        to)
            totarget="$2"
            echo "$totarget" | awk -F ':' '{print $1}' | grep -q "group"
            if [ $? = 0 ]
            then
                fun_group
            else
                fun_server "$totarget"
            fi
            shift 2
            ;;
        group)
	        check   input "$2"
	        db      group "$2"
		    connect group "$server_list" "$action"
		    shift
	        ;;
	    by)
		    # group by xxx
		    check input "$2"
		    group_by="$2"
		    shift
		    ;;
        server)
<<<<<<< HEAD
            SERVER_ARG="$2"
			check   input  "$SERVER_ARG"
			db      server "$SERVER_ARG" 
			connect server "$server_list" "$action"
=======
            Keywords="$2"
			check input "$Keywords"
			db    get   "$Keywords" 
			#connect server "$server_list" "$action"
>>>>>>> 4095480d0b51475b5d90c3b65c115ad07a8ba933
			shift
			;;
        info)
	        # info ip-address
	        
<<<<<<< HEAD
	        check input  "$2"
		    check perm	 "$2"
		    db    info	 "$2"
		    Print info   "$db_result" 
=======
	        check input "$2"
		    check perm  "$2"
		    db info     "$2"
		    Print info  "$db_result" 
>>>>>>> 4095480d0b51475b5d90c3b65c115ad07a8ba933
		    ;;
        search)
	        check input  "$2"
	        check empty  "$db_result"
	        Print list   "$db_result"
	        input rt 	 "userinput"
	        ;;
        login)
<<<<<<< HEAD
	        check   input  "$2"
	        db      server "$2"
=======
	        check input  "$2"
	        db    get    "$2"
>>>>>>> 4095480d0b51475b5d90c3b65c115ad07a8ba933
	        connect server "$server_login"
	        ;;
        option)
	        check input  "$2"
	        check option "$2"
	        shift
	        ;;
        transfer)
	        # transfer 10.1:/path 10.2:/path
	        # transfer file /path from 10.1 to /path on 10.2
	        check input   "$2"
	        check arg   2 "$2"
	        source_host=
	        source_file=
	        destsv_host=
	        destsv_file=
	        db get server "$source_host"
	        db get server "$destsv_host"
	        transmission $source_file from $source_host to $destsv_file on $destsv_host
	        ;;        
	    version)
		    msg version metis
            ;;
        help)
            msg help metis
            ;;
    esac
done
